<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Advanced Slurm jobs" href="advanced.html" /><link rel="prev" title="Running jobs using Slurm" href="index.html" />

    <!-- Generated with Sphinx 7.1.2 and Furo 2024.01.29 -->
        <title>Basic Slurm jobs - Esrum Cluster documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/playback.css?v=2c0b8537" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e2322aab" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Esrum Cluster  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">Esrum Cluster  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview of cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guidelines.html">Guidelines and policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using the cluster</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../access/access.html">Applying for access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../access/connecting.html">Connecting to the cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystem.html">Projects, data, and home folders</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Running jobs using Slurm</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Running jobs using Slurm</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Basic Slurm jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html">Advanced Slurm jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpu.html">Using the GPU/hi-MEM node</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Software on Esrum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transfers.html">Transferring data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../services/r.html">R and RStudio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/jupyter.html">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/containers.html">Containerized software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/shiny.html">Shiny servers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tips and tricks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tips/modules.html">Creating environment modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tips/tmux.html">Persistent sessions with tmux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tips/batching_commands.html">Batching commands in bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tips/robust_scripts.html">Writing robust bash scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tips/snakemake.html">Using Snakemake on Esrum</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Outreach</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../communications/messages.html">Messages from Data Analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../communications/presentations.html">Presentations</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/cbmr-data/cbmr-data.github.io/edit/main/esrum/source/usage/slurm/basics.rst" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="basic-slurm-jobs">
<span id="p-usage-slurm-basics"></span><h1>Basic Slurm jobs<a class="headerlink" href="#basic-slurm-jobs" title="Permalink to this heading">#</a></h1>
<p>This section describes the basics of queuing jobs using on the Esrum
cluster using the Slurm Workload Manager. This includes queuing tasks
with the <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> command , monitoring jobs with <code class="docutils literal notranslate"><span class="pre">squeue</span></code> and
<code class="docutils literal notranslate"><span class="pre">saccact</span></code>, cancelling jobs with <code class="docutils literal notranslate"><span class="pre">scancel</span></code>, and reserving resources
for jobs that need more CPUs or more RAM.</p>
<p>Users of the PBS (<code class="docutils literal notranslate"><span class="pre">qsub</span></code>) queuing system on e.g. <code class="docutils literal notranslate"><span class="pre">porus</span></code> or
<code class="docutils literal notranslate"><span class="pre">computerome</span></code> can use this <a class="reference external" href="https://www.nrel.gov/hpc/assets/pdfs/pbs-to-slurm-translation-sheet.pdf">PBS to Slurm translation-sheet</a> to
migrate <code class="docutils literal notranslate"><span class="pre">qsub</span></code> scripts/commands to <code class="docutils literal notranslate"><span class="pre">sbatch</span></code>.</p>
<section id="a-basic-job-script">
<h2>A basic job script<a class="headerlink" href="#a-basic-job-script" title="Permalink to this heading">#</a></h2>
<p>In order to run a job using the Slurm workload manager, you must first
write a shell script containing the commands that you want to execute.
In the following example we just run a single command, <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">&quot;Hello,</span>
<span class="pre">slurm!&quot;</span></code>, but scripts can contain any number of commands.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello, slurm!&quot;</span>
</pre></div>
</div>
<p>The script can be named anything you like and does not need to be
executable (via <code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">+x</span></code>), but the first line <em>must</em> contain a
<a class="reference external" href="https://en.wikipedia.org/wiki/Shebang_(Unix)">shebang</a> (the line starting with <code class="docutils literal notranslate"><span class="pre">#!</span></code>) to indicate how slurm should
execute it.</p>
<p>We use <code class="docutils literal notranslate"><span class="pre">#!/bin/bash</span></code> for the examples in this section, to indicate
that they are bash scripts, but it is also possible to use other
scripting languages by using the appropriate shebang (highlighted):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="ch">#!/usr/bin/env python3</span>
</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello, slurm!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Slurm scripts function like regular scripts for most part, meaning that
the current directory corresponds to the directory in which you executed
the script, that you can access environment variables set outside of the
script, and that it is possible to pass command-line arguments to your
scripts (see below).</p>
</section>
<section id="queuing-a-job">
<h2>Queuing a job<a class="headerlink" href="#queuing-a-job" title="Permalink to this heading">#</a></h2>
<p>In the following examples we will use the <code class="docutils literal notranslate"><span class="pre">igzip</span></code> command to compress
a file. The <code class="docutils literal notranslate"><span class="pre">igzip</span></code> command is similar to <code class="docutils literal notranslate"><span class="pre">gzip</span></code> except that it is
only available via a module, that it sacrifices compression ratio for
speed, and that it supports multiple threads. This allows us to test
those features with Slurm.</p>
<p>We start with a simple script, with which we will compress the FASTA
file <code class="docutils literal notranslate"><span class="pre">chr1.fasta</span></code>. This script is saved as <code class="docutils literal notranslate"><span class="pre">my_script.sh</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

module<span class="w"> </span>load<span class="w"> </span>igzip/2.30.0
igzip<span class="w"> </span>--keep<span class="w"> </span><span class="s2">&quot;chr1.fasta&quot;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">module</span></code> command is used load the required software from the
UCPH-IT provided library of scientific and other software. The
<a class="reference internal" href="../modules.html#p-usage-modules"><span class="std std-ref">Software on Esrum</span></a> page gives an introduction to using modules on
Esrum, but for now all you need to know is that the above command makes
the <code class="docutils literal notranslate"><span class="pre">igzip</span></code> tool available to us. We could also have loaded the module
on the command-line before queuing the command, as Slurm will remember
what modules we have loaded, but it is recommended to load all required
software <em>in</em> your job scripts to ensure that they are reproducible.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--keep</span></code> option for <code class="docutils literal notranslate"><span class="pre">igzip</span></code> is used to prevent igzip from
deleting our input file when it is done.</p>
<p>To queue this script, run the <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> command with the filename of
the script as an argument:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ls
chr1.fasta<span class="w">  </span>my_script.sh
$<span class="w"> </span>sbatch<span class="w"> </span>my_script.sh
Submitted<span class="w"> </span>batch<span class="w"> </span>job<span class="w"> </span><span class="m">8503</span>
</pre></div>
</div>
<p>Notice that we do not need to set the current working directory in our
script (unlike PBS). As noted above, this defaults to the directory in
which you queued the script. The number reported by sbatch is the job ID
of your job (<code class="docutils literal notranslate"><span class="pre">JOBID</span></code>), which you will need should you want to cancel,
pause, or otherwise manipulate your job (see below).</p>
<p>Once the job has started running (or has completed running), you will
also find a file named <code class="docutils literal notranslate"><span class="pre">slurm-${JOBID}.out</span></code> in the current folder,
where <code class="docutils literal notranslate"><span class="pre">${JOBID}</span></code> is the ID reported by <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> (<code class="docutils literal notranslate"><span class="pre">8503</span></code> in this
example):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ls
chr1.fasta<span class="w">  </span>chr1.fasta.gz<span class="w">  </span>my_script.sh<span class="w">  </span>slurm-8503.out
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">slurm-8503.out</span></code> file contains any console output produced by your
script/commands. This includes both STDOUT and STDERR by default, but
this can be changed (see <a class="reference internal" href="#s-common-options"><span class="std std-ref">Common options</span></a>). So if we had
misspelled the filename in our command then the resulting error message
would be found in the <code class="docutils literal notranslate"><span class="pre">out</span></code> file:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cat<span class="w"> </span>slurm-8503.out
igzip:<span class="w"> </span>chr1.fast<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
</pre></div>
</div>
<section id="passing-arguments-to-sbatch-scripts">
<h3>Passing arguments to sbatch scripts<a class="headerlink" href="#passing-arguments-to-sbatch-scripts" title="Permalink to this heading">#</a></h3>
<p>Arguments specified after the name of the <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> script are passed
to that script, just as if you were running it normally. This allows us
to update our script above to take a filename on the command line
instead of hard-coding that filename:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

module<span class="w"> </span>load<span class="w"> </span>igzip/2.30.0
igzip<span class="w"> </span>--keep<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>We can then invoke the script using <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> as above, specifying the
name of the file we wanted to compress on the command-line:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sbatch<span class="w"> </span>my_script.sh<span class="w"> </span><span class="s2">&quot;chr1.fasta&quot;</span>
</pre></div>
</div>
<p>This is equivalent to the original script, except that we can now easily
submit a job for any file that we want to process, without having to
update our script every time.</p>
<p>For further information, see <a class="reference external" href="https://www.baeldung.com/linux/use-command-line-arguments-in-bash-script">this</a>
this tutorial for a brief overview of ways to use command-line arguments
in a bash script.</p>
</section>
</section>
<section id="monitoring-your-jobs">
<h2>Monitoring your jobs<a class="headerlink" href="#monitoring-your-jobs" title="Permalink to this heading">#</a></h2>
<p>You can check the status of your queued and running jobs using the
<code class="docutils literal notranslate"><span class="pre">squeue</span> <span class="pre">--me</span></code> command. The <code class="docutils literal notranslate"><span class="pre">--me</span></code> option ensures that only <em>your</em>
jobs are shown, rather than everyone's jobs:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>squeue<span class="w"> </span>--me
JOBID<span class="w"> </span>PARTITION<span class="w">     </span>NAME<span class="w">     </span>USER<span class="w"> </span>ST<span class="w">       </span>TIME<span class="w">  </span>NODES<span class="w"> </span>NODELIST<span class="o">(</span>REASON<span class="o">)</span>
<span class="w"> </span><span class="m">8503</span><span class="w"> </span>standardq<span class="w"> </span>my_scrip<span class="w">   </span>abc123<span class="w">  </span>R<span class="w">       </span><span class="m">0</span>:02<span class="w">      </span><span class="m">1</span><span class="w"> </span>esrumcmpn01fl
</pre></div>
</div>
<p>The ST column indicating the status of the job (R for running, PD for
pending, <a class="reference external" href="https://slurm.schedmd.com/squeue.html#SECTION_JOB-STATE-CODES">and so on</a>).</p>
<p>Completed jobs are removed from the <code class="docutils literal notranslate"><span class="pre">squeue</span></code> list and can instead be
listed using <code class="docutils literal notranslate"><span class="pre">sacct</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sacct
<span class="w">       </span>JobID<span class="w">    </span>JobName<span class="w">  </span>Partition<span class="w">    </span>Account<span class="w">  </span>AllocCPUS<span class="w">      </span>State<span class="w"> </span>ExitCode
------------<span class="w"> </span>----------<span class="w"> </span>----------<span class="w"> </span>----------<span class="w"> </span>----------<span class="w"> </span>----------<span class="w"> </span>--------
<span class="m">8503</span><span class="w">         </span>my_script+<span class="w"> </span>standardq+<span class="w">                     </span><span class="m">1</span><span class="w">  </span>COMPLETED<span class="w">      </span><span class="m">0</span>:0
<span class="m">8503</span>.batch<span class="w">        </span>batch<span class="w">                                </span><span class="m">1</span><span class="w">  </span>COMPLETED<span class="w">      </span><span class="m">0</span>:0
</pre></div>
</div>
</section>
<section id="cancelling-jobs">
<span id="s-cancelling-jobs"></span><h2>Cancelling jobs<a class="headerlink" href="#cancelling-jobs" title="Permalink to this heading">#</a></h2>
<p>Already running jobs can be cancelled using the <code class="docutils literal notranslate"><span class="pre">scancel</span></code> command and
the ID of the job you want to cancel:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>squeue<span class="w"> </span>--me
JOBID<span class="w"> </span>PARTITION<span class="w">     </span>NAME<span class="w">     </span>USER<span class="w"> </span>ST<span class="w">       </span>TIME<span class="w">  </span>NODES<span class="w"> </span>NODELIST<span class="o">(</span>REASON<span class="o">)</span>
<span class="w"> </span><span class="m">8503</span><span class="w"> </span>standardq<span class="w"> </span>my_scrip<span class="w">   </span>abc123<span class="w">  </span>R<span class="w">       </span><span class="m">0</span>:02<span class="w">      </span><span class="m">1</span><span class="w"> </span>esrumcmpn01fl
$<span class="w"> </span>scancel<span class="w"> </span><span class="m">8503</span>
</pre></div>
</div>
<p>Should you wish to cancel <em>all</em> your jobs, use the <code class="docutils literal notranslate"><span class="pre">-u</span></code> option:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>scancel<span class="w"> </span>-u<span class="w"> </span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</pre></div>
</div>
<p>When running batch jobs you can either cancel the entire job (array, see
below) or individual sub-tasks. See the <a class="reference internal" href="advanced.html#s-job-arrays"><span class="std std-ref">Monitoring your jobs</span></a> section.</p>
</section>
<section id="setting-options">
<h2>Setting options<a class="headerlink" href="#setting-options" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> command offers two methods for setting options, such as
resource requirements, notifications, etc (see e.g.
<a class="reference internal" href="#s-common-options"><span class="std std-ref">Common options</span></a>). The first option is simply to specify the
options on the command line (e.g. <code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">--my-option</span> <span class="pre">my_script.sh</span></code>).</p>
<p>Note that options for <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> <em>must</em> be placed before the filename
for your script. Options placed <em>after</em> the filename for your script
(e.g. <code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">my_script.sh</span> <span class="pre">--my-option</span></code>) will instead be passed
directly to that script. This makes it simple to generalize scripts
using standard scripting techniques.</p>
<p>The second option, which we recommend for resource requirements and the
like, is to use <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code> comments.</p>
<p>For example, instead of queuing our job with the command</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sbatch<span class="w"> </span>--my-option<span class="w"> </span>my_script.sh
</pre></div>
</div>
<p>We could instead modify <code class="docutils literal notranslate"><span class="pre">my_script.sh</span></code> by adding a line containing
<code class="docutils literal notranslate"><span class="pre">#SBATCH</span> <span class="pre">--my-option</span></code> near the top of the file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="hll"><span class="c1">#SBATCH --my-option</span>
</span>
module<span class="w"> </span>load<span class="w"> </span>igzip/2.30.0
igzip<span class="w"> </span>--keep<span class="w"> </span><span class="s2">&quot;chr1.fasta&quot;</span>
</pre></div>
</div>
<p>If we do so, then running <code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">my_script.sh</span></code> becomes the equivalent
of running <code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">--my-option</span> <span class="pre">my_script.sh</span></code>. This had the advantage
that our options are recorded along with the commands, and that we do
not have to remember to specify those options every time we run <code class="docutils literal notranslate"><span class="pre">sbatch</span>
<span class="pre">my_script.sh</span></code>.</p>
<p>This documentation will make use of <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code> comments, but remember
that you can also specify them directly on the command-line. If you
specify options on the command-line, then they take precedence above
options specified using <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code> comments.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code> lines must be at the top of the file, before any
other commands or the like. Moreover, there must be no spaces before
or after the <code class="docutils literal notranslate"><span class="pre">#</span></code> in the <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code> comments. Other comments (lines
starting with <code class="docutils literal notranslate"><span class="pre">#</span></code>) are allowed before and after the <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code>
comments.</p>
<p><code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code> comments can also be used with other scripting languages,
provided that you follow the rules described above, but note that
source-code formatters like <code class="docutils literal notranslate"><span class="pre">black</span></code> may add spaces after the <code class="docutils literal notranslate"><span class="pre">#</span></code>
and thereby break the <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code> comments.</p>
</div>
</section>
<section id="reserving-resources">
<span id="id1"></span><h2>Reserving resources<a class="headerlink" href="#reserving-resources" title="Permalink to this heading">#</a></h2>
<p>By default a <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> will request 1 CPU and just under 15 GB of ram
per reserved CPU. Jobs will not be executed before the requested
resources are available on a node and your jobs cannot exceed the amount
of resources you've requested.</p>
<p>Should your job require more CPUs, then you can request them using the
<code class="docutils literal notranslate"><span class="pre">-c</span></code> or <code class="docutils literal notranslate"><span class="pre">--cpus-per-task</span></code> option. The following script runs a job
with 8 CPUs, and is therefore automatically assigned 8 * 15 ~= 120
gigabytes of RAM:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="hll"><span class="c1">#SBATCH --cpus-per-task 8</span>
</span>
module<span class="w"> </span>load<span class="w"> </span>igzip/2.30.0
<span class="hll">igzip<span class="w"> </span>--keep<span class="w"> </span>--threads<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="s2">&quot;chr1.fasta&quot;</span>
</span></pre></div>
</div>
<p>Notice that we need to not only reserve the CPUs, but we in almost all
cases also need tell to our programs to actually use those CPUs. With
<code class="docutils literal notranslate"><span class="pre">igzip</span></code> this is accomplished by using the <code class="docutils literal notranslate"><span class="pre">--threads</span></code> option as
shown above. If this is not done then the reserved CPUs will have no
effect on how long it takes for your program to run!</p>
<p>To avoid having to write the same number of threads multiple times, we
can instead use hte <code class="docutils literal notranslate"><span class="pre">${SLURM_CPUS_PER_TASK}</span></code> variable, which is
automatically set to the number of CPUs we've requested:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --cpus-per-task 8</span>

module<span class="w"> </span>load<span class="w"> </span>igzip/2.30.0
<span class="hll">igzip<span class="w"> </span>--keep<span class="w"> </span>--threads<span class="w"> </span><span class="si">${</span><span class="nv">SLURM_CPUS_PER_TASK</span><span class="si">}</span><span class="w"> </span><span class="s2">&quot;chr1.fasta&quot;</span>
</span></pre></div>
</div>
<p>The amount of RAM allocated by default should be sufficient for most
tasks, but when needed you can request additional RAM using either the
<code class="docutils literal notranslate"><span class="pre">--mem-per-cpu</span></code> or the <code class="docutils literal notranslate"><span class="pre">--mem</span></code> options. The <code class="docutils literal notranslate"><span class="pre">--mem-per-cpu</span></code> option
allow you to request an amount of memory that depends on the number of
CPUs you request (defaulting to just under 15 GB per CPU), while the
<code class="docutils literal notranslate"><span class="pre">--mem</span></code> option allows you to request a specific amount of memory
regardless of how many (or how few) CPUs you reserve.</p>
<p>The following script a task with 8 CPUs and 512 gigabytes of RAM:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --cpus-per-task 8</span>
<span class="hll"><span class="c1">#SBATCH --mem 512G</span>
</span>
module<span class="w"> </span>load<span class="w"> </span>igzip/2.30.0
igzip<span class="w"> </span>--keep<span class="w"> </span>--threads<span class="w"> </span><span class="si">${</span><span class="nv">SLURM_CPUS_PER_TASK</span><span class="si">}</span><span class="w"> </span><span class="s2">&quot;chr1.fasta&quot;</span>
</pre></div>
</div>
<p>The same total could have been requested by using <code class="docutils literal notranslate"><span class="pre">#SBATCH</span>
<span class="pre">--mem-per-cpu</span> <span class="pre">64G</span></code> instead of <code class="docutils literal notranslate"><span class="pre">#SBATCH</span> <span class="pre">--mem</span> <span class="pre">512G</span></code>.</p>
<p>As described in the <a class="reference internal" href="../../overview.html#p-overview"><span class="std std-ref">Overview of cluster</span></a>, each node has 128 CPUs available
and 2 TB of RAM, of which 1993 GB can be reserved by Slurm. The GPU node
has 4 TB of RAM available, of which 3920 GB can be reserved by Slurm,
and may be used for jobs that have very high memory requirements.
However, since we only have one GPU node we ask that you use the regular
nodes unless your jobs actually require that much RAM. See the
<a class="reference internal" href="gpu.html#p-usage-slurm-gpu"><span class="std std-ref">Using the GPU/hi-MEM node</span></a> section for how to use the GPU node with or
without reserving a GPU.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--nodes</span></code> option and the <code class="docutils literal notranslate"><span class="pre">--ntasks</span></code> option will start
<em>identical</em> tasks on one or more nodes, so you should <em>not</em> be using
these options unless your tools are specifically designed for this!
Otherwise each instance will try to write to the same output file(s)
and will produce results that are very likely corrupt.</p>
<p>If you need to run the same command on a set of files/samples, then
see the <a class="reference internal" href="advanced.html#s-job-arrays"><span class="std std-ref">Monitoring your jobs</span></a> section.</p>
</div>
<section id="best-practice-for-reserving-resources">
<h3>Best practice for reserving resources<a class="headerlink" href="#best-practice-for-reserving-resources" title="Permalink to this heading">#</a></h3>
<p>Determining how many CPUs and how much memory you need to reserve for
your jobs can be difficult:</p>
<p>Few programs benefit from using a lot of threads (CPUs) due to overhead
and due to limits to how much of a given process can be parallelized
(see <a class="reference external" href="https://en.wikipedia.org/wiki/Amdahl%27s_law">Amdahl's law</a>).
Maximum throughput is often limited by how fast the software can
read/write data.</p>
<p>We therefore recommended that you</p>
<ul class="simple">
<li><p>Always refer to the documentation and recommendations for the
specific software you are using!</p></li>
<li><p>Test the effect of the number of threads you are using before
starting a lot of jobs.</p></li>
<li><p>Start with fewer CPUs and increase it only when there is a benefit to
doing so. You can for example start with 2, 4, or 8 CPUs per task,
and only increasing the number after it has been determined that the
software benefits from the additional CPUs.</p></li>
</ul>
</section>
<section id="monitoring-resources-used-by-jobs">
<h3>Monitoring resources used by jobs<a class="headerlink" href="#monitoring-resources-used-by-jobs" title="Permalink to this heading">#</a></h3>
<p>Once you have actually started running a job, you have several options
for monitoring resource usage:</p>
<p>The <code class="docutils literal notranslate"><span class="pre">/usr/bin/time</span> <span class="pre">-f</span> <span class="pre">&quot;CPU</span> <span class="pre">=</span> <span class="pre">%P,</span> <span class="pre">MEM</span> <span class="pre">=</span> <span class="pre">%MKB&quot;</span></code> command can be used to
estimate the efficiency from using multiple threads and to show how much
memory a program used:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>/usr/bin/time<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;CPU = %P, MEM = %M&quot;</span><span class="w"> </span>my-command<span class="w"> </span>--threads<span class="w"> </span><span class="m">1</span><span class="w"> </span>...
<span class="go">CPU = 99%, MEM = 840563KB</span>
<span class="gp">$ </span>/usr/bin/time<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;CPU = %P, MEM = %M&quot;</span><span class="w"> </span>my-command<span class="w"> </span>--threads<span class="w"> </span><span class="m">4</span><span class="w"> </span>...
<span class="go">CPU = 345%, MEM = 892341KB</span>
<span class="gp">$ </span>/usr/bin/time<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;CPU = %P, MEM = %M&quot;</span><span class="w"> </span>my-command<span class="w"> </span>--threads<span class="w"> </span><span class="m">8</span><span class="w"> </span>...
<span class="go">CPU = 605%, MEM = 936324KB</span>
</pre></div>
</div>
<p>In this example increasing the number of threads/CPUs to 4 did not
result in a 4x increase in CPU usage, but only an 3.5x increase with 4
CPUs and only a 6x increase with 8 CPUs. Here it would be more efficient
to run to tasks with 4 CPUs rather than one task with 8 CPUs.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">sacct</span></code> command may be used to review the average CPU usage, the
peak memory usage, disk I/O, and more for completed jobs. This makes it
easier to verify that you are not needlessly reserving resources. A
helper script is provided that summarizes some of this information in an
easily readable form:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">source</span><span class="w"> </span>/projects/cbmr_shared/apps/modules/activate.sh
<span class="gp">$ </span>module<span class="w"> </span>load<span class="w"> </span>sacct-usage
<span class="gp">$ </span>sacct-usage
<span class="go">      Age  User    Job   State         Elapsed  CPUs  CPUsWasted  ExtraMem  ExtraMemWasted  CPUHoursWasted</span>
<span class="go">13:32:04s  abc123  1     FAILED     252:04:52s     8         6.9     131.4           131.4         4012.14</span>
<span class="go">10:54:32s  abc123  2[1]  COMPLETED   02:49:25s    32        15.7       0.0             0.0           44.38</span>
<span class="go">01:48:43s  abc123  3     COMPLETED   01:00:53s    24         2.4       0.0             0.0            2.43</span>
</pre></div>
</div>
<p>The important information is found in the <code class="docutils literal notranslate"><span class="pre">CPUsWasted</span></code> column and the
<code class="docutils literal notranslate"><span class="pre">ExtraMemWasted</span></code> column, which show the number CPUs that went unused
on average the memory that was requested that went unused. Note that
<code class="docutils literal notranslate"><span class="pre">ExtraMem</span></code> only counts memory requested <em>in addition</em> to the default
allocation of ~16GB of RAM per CPU. That is because any additional
reserved memory results in CPUs going unused <em>unless</em> a user explicitly
asks for less RAM than the default ~16GB per CPU.</p>
<p>The final column indicates that number of CPU hours your job wasted,
calculated as the length of time your job ran multiplied by the number
of reserved CPUs wasted and the number of CPUs that would have been able
to get the default 16GB of RAM had <code class="docutils literal notranslate"><span class="pre">ExtraMemWasted</span></code> been zero. Aim for
your jobs to resemble the third job, not the second job and especially
not the first job in the example!</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Wasted</span></code> statistics are based on snapshots of resource usage
produced by Slurm and are therefore not 100% accurate. Notably, the
memory usage statistics are based on maximum memory usage of
individual processes, rather than the maximum cumulative memory
usage, and may therefore greatly overestimate wasted memory if you
are running multiple simultaneous processes in a pipeline.</p>
</div>
<p>When reserving jobs with additional resources it can also be useful to
monitor CPU/memory usage in real time. This can help diagnose poor
resource usage much faster than waiting for the program to finish
running. See the <a class="reference internal" href="advanced.html#s-monitoring-processes-in-jobs"><span class="std std-ref">Monitoring processes in jobs</span></a> section for
information about how to do so.</p>
<p>Because of this it is often more efficient to split your job into
multiple sub-jobs (for example one job per chromosome) rather than
increasing the number of threads used for the individual jobs. See the
<a class="reference internal" href="advanced.html#p-usage-slurm-advanced"><span class="std std-ref">Advanced Slurm jobs</span></a> page for more information about batching
jobs.</p>
</section>
<section id="common-options">
<span id="s-common-options"></span><h3>Common options<a class="headerlink" href="#common-options" title="Permalink to this heading">#</a></h3>
<p>The following provides a brief overview of common options for <code class="docutils literal notranslate"><span class="pre">sbatch</span></code>
not mentioned above. All of these options may be specified using
<code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code> comments.</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--job-name</span></code> option allows you to give a name to your job. This
shows up when using <code class="docutils literal notranslate"><span class="pre">squeue</span></code>, <code class="docutils literal notranslate"><span class="pre">sacct</span></code> and more. If not specified,
the name of your script is used instead.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--output</span></code> and <code class="docutils literal notranslate"><span class="pre">--error</span></code> options allow you to specify where
Slurm writes your scripts STDOUT and STDERR. The filenames should
always include the text <code class="docutils literal notranslate"><span class="pre">%j</span></code>, which is replaced with the job ID.
See the manual page for usage. Note also that the destination folder
<em>must</em> exist or no output will be saved!</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--time</span></code> can be used to limit the maximum running time of your
script. We do not require that <code class="docutils literal notranslate"><span class="pre">--time</span></code> is set, but it may be
useful to automatically stop jobs that unexpectedly take too long to
run. See the <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> manual page for how to specify time limits.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--test-only</span></code> can be used to test your batch scripts. Combine it
with <code class="docutils literal notranslate"><span class="pre">--verbose</span></code> to verify that your options are correctly set
before queuing your job:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sbatch<span class="w"> </span>--test-only<span class="w"> </span>--verbose<span class="w"> </span>my_script.sh
sbatch:<span class="w"> </span>defined<span class="w"> </span>options
sbatch:<span class="w"> </span>--------------------<span class="w"> </span>--------------------
sbatch:<span class="w"> </span>cpus-per-task<span class="w">       </span>:<span class="w"> </span><span class="m">8</span>
sbatch:<span class="w"> </span>test-only<span class="w">           </span>:<span class="w"> </span><span class="nb">set</span>
sbatch:<span class="w"> </span><span class="nb">time</span><span class="w">                </span>:<span class="w"> </span><span class="m">01</span>:00:00
sbatch:<span class="w"> </span>verbose<span class="w">             </span>:<span class="w"> </span><span class="m">1</span>
sbatch:<span class="w"> </span>--------------------<span class="w"> </span>--------------------
sbatch:<span class="w"> </span>end<span class="w"> </span>of<span class="w"> </span>defined<span class="w"> </span>options
<span class="o">[</span>...<span class="o">]</span>
sbatch:<span class="w"> </span>Job<span class="w"> </span><span class="m">8568</span><span class="w"> </span>to<span class="w"> </span>start<span class="w"> </span>at<span class="w"> </span><span class="m">2023</span>-06-28T12:15:32<span class="w"> </span>using<span class="w"> </span><span class="m">8</span><span class="w"> </span>processors<span class="w"> </span>on<span class="w"> </span>nodes<span class="w"> </span>esrumcmpn02fl<span class="w"> </span><span class="k">in</span><span class="w"> </span>partition<span class="w"> </span>standardqueue
</pre></div>
</div>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--wait</span></code> option can be used to make the <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> block until
the queued tasks have completed. This can be useful if you want to
run sbatch from another script.</p></li>
</ul>
</section>
</section>
<section id="interactive-sessions">
<span id="s-interactive-session"></span><h2>Interactive sessions<a class="headerlink" href="#interactive-sessions" title="Permalink to this heading">#</a></h2>
<p>If you need to run an interactive process, for example if you need to
use an interactive R shell to process a large dataset, or if you just
need to experiment with running an computationally heavy process, then
you can start a shell on one of the compute nodes as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[abc123@esrumhead01fl ~] $ </span>srun<span class="w"> </span>--pty<span class="w"> </span>--<span class="w"> </span>/bin/bash
<span class="gp">[abc123@esrumcmpn07fl ~] $</span>
</pre></div>
</div>
<p>Note how the hostname displayed changes from <code class="docutils literal notranslate"><span class="pre">esrumhead01fl</span></code> to
<code class="docutils literal notranslate"><span class="pre">esrumcmpn07fl</span></code>, where <code class="docutils literal notranslate"><span class="pre">esrumcmpn07fl</span></code> may be any one of the Esrum
compute nodes.</p>
<p>You can now run interactive programs, for example an R shell, or test
computationally expensive tools or scripts. However, note that you
<em>cannot</em> start jobs using Slurm in an interactive shell; jobs can only
be started from the head node.</p>
<p><code class="docutils literal notranslate"><span class="pre">srun</span></code> takes most of the same arguments as <code class="docutils literal notranslate"><span class="pre">sbatch</span></code>, including those
used for reserving additional resources if you need more than the
default 1 CPU and 15 GB of RAM:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>srun<span class="w"> </span>--cpus-per-task<span class="w"> </span><span class="m">4</span><span class="w"> </span>--mem<span class="w"> </span>128G<span class="w"> </span>--pty<span class="w"> </span>--<span class="w"> </span>/bin/bash
</pre></div>
</div>
<p>It is also possible to start an interactive session on the GPU/High-MEM
nodes. See the <a class="reference internal" href="gpu.html#p-usage-slurm-gpu"><span class="std std-ref">Using the GPU/hi-MEM node</span></a> page for more information. See
the <a class="reference internal" href="advanced.html#p-usage-slurm-advanced"><span class="std std-ref">Advanced Slurm jobs</span></a> page for more information about the
<code class="docutils literal notranslate"><span class="pre">srun</span></code> command.</p>
<p>Once you are done, be sure to exit the interactive shell by using the
<code class="docutils literal notranslate"><span class="pre">exit</span></code> command or pressing <code class="docutils literal notranslate"><span class="pre">Ctrl+D</span></code>, so that the resources reserved
for your shell are made available to other users!</p>
<section id="running-graphical-programs">
<h3>Running graphical programs<a class="headerlink" href="#running-graphical-programs" title="Permalink to this heading">#</a></h3>
<p>Should you need to run a graphical program in an interactive session,
then you must 1) enable X11 forwarding in the program you use to connect
to the cluster (e.g. using <code class="docutils literal notranslate"><span class="pre">-X</span></code> option with <code class="docutils literal notranslate"><span class="pre">ssh</span></code>), and 2) specify
the <code class="docutils literal notranslate"><span class="pre">--x11</span></code> option when starting your interactive session:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ssh<span class="w"> </span>-X<span class="w"> </span>esrumhead01fl
<span class="gp">$ </span>srun<span class="w"> </span>--pty<span class="w"> </span>--x11<span class="w"> </span>--<span class="w"> </span>/bin/bash
<span class="gp">$ </span>xclock
</pre></div>
</div>
<p>If X11 forwarding is correctly enabled in your client, then you should
see a small clock application on your desktop:</p>
<img alt="../../_images/xclock.png" class="align-center" src="../../_images/xclock.png" />
</section>
</section>
<section id="sbatch-template-script">
<h2><code class="docutils literal notranslate"><span class="pre">sbatch</span></code> template script<a class="headerlink" href="#sbatch-template-script" title="Permalink to this heading">#</a></h2>
<p>The following is a simple template for use with the <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> command.
This script can also be downloaded <a class="reference download internal" download="" href="../../_downloads/eef93ad11e793473b503cfdf552be41a/my_sbatch.sh"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># The following are commonly used options for running jobs. Remove one</span>
<span class="c1"># &quot;#&quot; from the &quot;##SBATCH&quot; lines (changing them to &quot;#SBATCH&quot;) to enable</span>
<span class="c1"># a given option.</span>

<span class="c1"># The number of CPUs (cores) used by your task. Defaults to 1.</span>
<span class="c1">##SBATCH --cpus-per-task=1</span>
<span class="c1"># The amount of RAM used by your task. Tasks are automatically assigned 15G</span>
<span class="c1"># per CPU (set above) if this option is not set.</span>
<span class="c1">##SBATCH --mem=15G</span>
<span class="c1"># Set a maximum runtime in hours:minutes:seconds. No default limit.</span>
<span class="c1">##SBATCH --time=1:00:00</span>
<span class="c1"># Request a GPU on the GPU code. Use `--gres=gpu:a100:2` to request both GPUs.</span>
<span class="c1">##SBATCH --partition=gpuqueue --gres=gpu:a100:1</span>
<span class="c1"># Send notifications when job ends. Remember to update the email address!</span>
<span class="c1">##SBATCH --mail-user=abc123@ku.dk --mail-type=END,FAIL</span>

<span class="c1">########################</span>
<span class="c1"># Your commands go here:</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello world!&quot;</span>
</pre></div>
</div>
<p>See also the <a class="reference internal" href="../../tips/robust_scripts.html#p-tips-robustscripts"><span class="std std-ref">Writing robust bash scripts</span></a> page for tips on how to write
more robust bash scripts. A template using those recommendations is
available for download <a class="reference download internal" download="" href="../../_downloads/49203405115f2f4c7de966ac8b3525da/robust_sbatch.sh"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>.</p>
</section>
<section id="what-s-next">
<span id="s-slurm-basics-troubleshooting"></span><h2>What's next<a class="headerlink" href="#what-s-next" title="Permalink to this heading">#</a></h2>
<p>The next section of the documentation covers advanced usage of Slurm,
including how to run jobs on the High-MEM/GPU node. However, if you have
not already done so then it is recommended that you read the
<a class="reference internal" href="../modules.html#p-usage-modules"><span class="std std-ref">Software on Esrum</span></a> page for an introduction on how to use the module
system on Esrum to load the software you need for your work.</p>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading">#</a></h2>
<section id="error-requested-node-configuration-is-not-available">
<h3>Error: Requested node configuration is not available<a class="headerlink" href="#error-requested-node-configuration-is-not-available" title="Permalink to this heading">#</a></h3>
<p>If you request too many CPUs (more than 128), or too much RAM (more than
1993 GB for compute nodes and more than 3920 GB for the GPU node), then
Slurm will report that the request cannot be satisfied:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># More than 128 CPUs requested</span>
$<span class="w"> </span>sbatch<span class="w"> </span>--cpus-per-task<span class="w"> </span><span class="m">200</span><span class="w"> </span>my_script.sh
sbatch:<span class="w"> </span>error:<span class="w"> </span>CPU<span class="w"> </span>count<span class="w"> </span>per<span class="w"> </span>node<span class="w"> </span>can<span class="w"> </span>not<span class="w"> </span>be<span class="w"> </span>satisfied
sbatch:<span class="w"> </span>error:<span class="w"> </span>Batch<span class="w"> </span>job<span class="w"> </span>submission<span class="w"> </span>failed:<span class="w"> </span>Requested<span class="w"> </span>node<span class="w"> </span>configuration<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>available

<span class="c1"># More than 1993 GB RAM requested on compute node</span>
$<span class="w"> </span>sbatch<span class="w"> </span>--mem<span class="w"> </span>2000G<span class="w"> </span>my_script.sh
sbatch:<span class="w"> </span>error:<span class="w"> </span>Memory<span class="w"> </span>specification<span class="w"> </span>can<span class="w"> </span>not<span class="w"> </span>be<span class="w"> </span>satisfied
sbatch:<span class="w"> </span>error:<span class="w"> </span>Batch<span class="w"> </span>job<span class="w"> </span>submission<span class="w"> </span>failed:<span class="w"> </span>Requested<span class="w"> </span>node<span class="w"> </span>configuration<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>available
</pre></div>
</div>
<p>To solve this, simply reduce the number of CPUs and/or the amount of RAM
requested to fit within the limits described above. If your task does
require more than 1993 GB of RAM, then you also need to add the
<code class="docutils literal notranslate"><span class="pre">--partition=gpuqueue</span></code>, so that your task gets scheduled on the
GPU/High-MEM node.</p>
<p>Additionally, you may receive this message if you request GPUs without
specifying the correct queue or if you request too many GPUs:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># --partition=gpuqueue not specified</span>
$<span class="w"> </span>srun<span class="w"> </span>--gres<span class="o">=</span>gpu:2<span class="w"> </span>--<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello world!&quot;</span>
srun:<span class="w"> </span>error:<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>allocate<span class="w"> </span>resources:<span class="w"> </span>Requested<span class="w"> </span>node<span class="w"> </span>configuration<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>available

<span class="c1"># More than 2 GPUs requested</span>
$<span class="w"> </span>srun<span class="w"> </span>--partition<span class="o">=</span>gpuqueue<span class="w"> </span>--gres<span class="o">=</span>gpu:3<span class="w"> </span>--<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello world!&quot;</span>
srun:<span class="w"> </span>error:<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>allocate<span class="w"> </span>resources:<span class="w"> </span>Requested<span class="w"> </span>node<span class="w"> </span>configuration<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>available
</pre></div>
</div>
<p>To solve this error, simply avoid requesting more than 2 GPUs, and
remember to include the <code class="docutils literal notranslate"><span class="pre">--partition=gpuqueue</span></code> option.</p>
<p>See also the <a class="reference internal" href="gpu.html#p-usage-slurm-gpu"><span class="std std-ref">Using the GPU/hi-MEM node</span></a> section.</p>
</section>
</section>
<section id="additional-resources">
<h2>Additional resources<a class="headerlink" href="#additional-resources" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Slurm <a class="reference external" href="https://slurm.schedmd.com/overview.html">documentation</a></p></li>
<li><p>Slurm <a class="reference external" href="https://slurm.schedmd.com/pdfs/summary.pdf">summary</a> (PDF)</p></li>
<li><p>The <a class="reference external" href="https://slurm.schedmd.com/sbatch.html">sbatch manual page</a></p></li>
<li><p>The <a class="reference external" href="https://slurm.schedmd.com/srun.html">srun manual page</a></p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="advanced.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Advanced Slurm jobs</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Running jobs using Slurm</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023-2024, CBMR Data Analytics; licensed under CC-BY 4.0
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Basic Slurm jobs</a><ul>
<li><a class="reference internal" href="#a-basic-job-script">A basic job script</a></li>
<li><a class="reference internal" href="#queuing-a-job">Queuing a job</a><ul>
<li><a class="reference internal" href="#passing-arguments-to-sbatch-scripts">Passing arguments to sbatch scripts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#monitoring-your-jobs">Monitoring your jobs</a></li>
<li><a class="reference internal" href="#cancelling-jobs">Cancelling jobs</a></li>
<li><a class="reference internal" href="#setting-options">Setting options</a></li>
<li><a class="reference internal" href="#reserving-resources">Reserving resources</a><ul>
<li><a class="reference internal" href="#best-practice-for-reserving-resources">Best practice for reserving resources</a></li>
<li><a class="reference internal" href="#monitoring-resources-used-by-jobs">Monitoring resources used by jobs</a></li>
<li><a class="reference internal" href="#common-options">Common options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interactive-sessions">Interactive sessions</a><ul>
<li><a class="reference internal" href="#running-graphical-programs">Running graphical programs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sbatch-template-script"><code class="docutils literal notranslate"><span class="pre">sbatch</span></code> template script</a></li>
<li><a class="reference internal" href="#what-s-next">What's next</a></li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li><a class="reference internal" href="#error-requested-node-configuration-is-not-available">Error: Requested node configuration is not available</a></li>
</ul>
</li>
<li><a class="reference internal" href="#additional-resources">Additional resources</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../../_static/js/custom.js?v=3a8ddbd3"></script>
    <script src="../../_static/js/libgif.js?v=7adcb026"></script>
    <script src="../../_static/js/playback.js?v=d7002ce9"></script>
    </body>
</html>