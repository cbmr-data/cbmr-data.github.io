<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="search" title="Search" href="../search.html" /><link rel="next" title="6.4. Writing robust bash scripts" href="robust_scripts.html" /><link rel="prev" title="6.2. Persistent sessions with tmux" href="tmux.html" />

    <!-- Generated with Sphinx 7.1.2 and Furo 2024.01.29 -->
        <title>6.3. Batching commands outside Slurm - Esrum Cluster documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/playback.css?v=2c0b8537" />
    <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e2322aab" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Esrum Cluster  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Esrum Cluster  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../contact.html">1. Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">2. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guidelines.html">3. Guidelines</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../usage/index.html">4. Using the cluster</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of 4. Using the cluster</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../usage/access/index.html">4.1. Accessing the cluster</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 4.1. Accessing the cluster</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/access/access.html">4.1.1. Applying for access</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/access/connecting.html">4.1.2. Connecting to the cluster</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/filesystem.html">4.2. Projects, data, and home folders</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../usage/slurm/index.html">4.3. Running jobs using Slurm</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of 4.3. Running jobs using Slurm</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../usage/slurm/basics.html">4.3.1. Basic Slurm jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/slurm/advanced.html">4.3.2. Advanced Slurm jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage/slurm/gpu.html">4.3.3. Using the GPU/hi-MEM node</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usage/modules.html">4.4. Environment modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/transfers.html">4.5. Transferring data</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../services/index.html">5. Other services</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of 5. Other services</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../services/rstudio.html">5.1. R, RStudio, and Jupyter Notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/containers.html">5.2. Running containerized software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/shiny.html">5.3. Public and private Shiny servers</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">6. Tips and tricks</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of 6. Tips and tricks</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="modules.html">6.1. Creating environment modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="tmux.html">6.2. Persistent sessions with tmux</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">6.3. Batching commands outside Slurm</a></li>
<li class="toctree-l2"><a class="reference internal" href="robust_scripts.html">6.4. Writing robust bash scripts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">7. Troubleshooting</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../communications/index.html">8. Communications</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 8. Communications</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../communications/welcome.html">8.1. Welcome to CBMRs Compute Cluster Esrum!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../communications/workshops.html">8.2. Workshops and other presentations</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/cbmr-data/cbmr-data.github.io/edit/main/esrum/source/tips/batching_commands.rst" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="batching-commands-outside-slurm">
<span id="p-tips-batching"></span><h1><span class="section-number">6.3. </span>Batching commands outside Slurm<a class="headerlink" href="#batching-commands-outside-slurm" title="Permalink to this heading">#</a></h1>
<p>This section describes way to batch commands without using Slurm. This
is intended to be used both with singular jobs and in conjunction with
Slurm job arrays (see the <a class="reference internal" href="../usage/slurm/advanced.html#s-job-arrays"><span class="std std-ref">Monitoring your jobs</span></a> section), for example when
you need to run a large number of small jobs.</p>
<p>Running tasks as described on this page has a lower overhead than jobs
scheduled tasks via Slurm, and is therefore well suited for running
many, small tasks. However, for larger jobs you should still prefer job
arrays if possible.</p>
<p>This section covers basic loops in bash and the <cite>parallel</cite> command.
Other options include <a class="reference external" href="https://man7.org/linux/man-pages/man1/xargs.1.html">xargs</a>, <a class="reference external" href="https://www.gnu.org/software/make/">make</a>, <a class="reference external" href="https://snakemake.readthedocs.io/">snakemake</a>, and much, much more.</p>
<section id="running-commands-sequentially-in-bash">
<h2><span class="section-number">6.3.1. </span>Running commands sequentially in bash<a class="headerlink" href="#running-commands-sequentially-in-bash" title="Permalink to this heading">#</a></h2>
<p>If you need to run a number of (very) short running commands, then it is
likely more efficient to do so with a simple loop in your <code class="docutils literal notranslate"><span class="pre">sbatch</span></code>
script. For example, this script runs the <code class="docutils literal notranslate"><span class="pre">plonk</span></code> command on a number
of population VCF files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
module<span class="w"> </span>load<span class="w"> </span>plonk/3.14

<span class="k">for</span><span class="w"> </span>pop<span class="w"> </span><span class="k">in</span><span class="w"> </span>CHB<span class="w"> </span>FIN<span class="w"> </span>GBR<span class="w"> </span>JPT<span class="w"> </span>PUR<span class="w"> </span>YRI<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span>plonk<span class="w"> </span>--input<span class="w"> </span><span class="s2">&quot;./my_data/</span><span class="si">${</span><span class="nv">pop</span><span class="si">}</span><span class="s2">.vcf&quot;</span><span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;./my_results/</span><span class="si">${</span><span class="nv">pop</span><span class="si">}</span><span class="s2">.out&quot;</span>
<span class="k">done</span>
</pre></div>
</div>
<p>The following command indexes a number of (small) BAM files in the
current directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
module<span class="w"> </span>load<span class="w"> </span>samtools/1.17

<span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>./*.bam<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span>samtools<span class="w"> </span>index<span class="w"> </span><span class="si">${</span><span class="nv">filename</span><span class="si">}</span>
<span class="k">done</span>
</pre></div>
</div>
<p>However, it is important to remember that the total runtime will be the
<em>sum</em> of run-times for each task, since they are run one after the
other. It is therefore not recommended to use loops like this for
commands that take more than a few of minutes to complete!</p>
</section>
<section id="running-commands-in-parallel-in-bash">
<h2><span class="section-number">6.3.2. </span>Running commands in parallel in bash<a class="headerlink" href="#running-commands-in-parallel-in-bash" title="Permalink to this heading">#</a></h2>
<p>The GNU <a class="reference external" href="https://www.gnu.org/software/parallel/">parallel</a> commands offers a range of options for running
commands in parallel.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
module<span class="w"> </span>load<span class="w"> </span>plonk/3.14
module<span class="w"> </span>load<span class="w"> </span>parallel/20230822

parallel<span class="w"> </span>-P<span class="w"> </span><span class="si">${</span><span class="nv">SLURM_CPUS_PER_TASK</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>plonk<span class="w"> </span>--input<span class="w"> </span><span class="s2">&quot;./my_data/{}.vcf&quot;</span><span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;./my_results/{}.out&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>:::<span class="w"> </span>CHB<span class="w"> </span>FIN<span class="w"> </span>GBR<span class="w"> </span>JPT<span class="w"> </span>PUR<span class="w"> </span>YRI
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">parallel</span></code> command will then execute <code class="docutils literal notranslate"><span class="pre">plonk</span></code> once for each of
the values we specified after the <code class="docutils literal notranslate"><span class="pre">:::</span></code> and replace the text <code class="docutils literal notranslate"><span class="pre">{}</span></code>
with the current value.</p>
<p>The second <code class="docutils literal notranslate"><span class="pre">xargs</span></code> example above can be run in parallel as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
module<span class="w"> </span>load<span class="w"> </span>samtools/1.17
module<span class="w"> </span>load<span class="w"> </span>parallel/20230822

parallel<span class="w"> </span>-P<span class="w"> </span><span class="si">${</span><span class="nv">SLURM_CPUS_PER_TASK</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>samtools<span class="w"> </span>index<span class="w"> </span><span class="s2">&quot;{}&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>:::<span class="w"> </span>./*.bam
</pre></div>
</div>
<p>If no <code class="docutils literal notranslate"><span class="pre">{}</span></code> is specified the value will be appended to the command.
Additionally, <code class="docutils literal notranslate"><span class="pre">parallel</span></code> can read values from STDIN, meaning that the
above could also be written as</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
module<span class="w"> </span>load<span class="w"> </span>samtools/1.17
module<span class="w"> </span>load<span class="w"> </span>parallel/20230822

ls<span class="w"> </span>./*.bam<span class="w"> </span><span class="p">|</span><span class="w"> </span>parallel<span class="w"> </span>-P<span class="w"> </span><span class="si">${</span><span class="nv">SLURM_CPUS_PER_TASK</span><span class="si">}</span><span class="w"> </span>samtools<span class="w"> </span>index
</pre></div>
</div>
<p>Each line on STDIN is treated as one value.</p>
<section id="best-practices-for-reserving-resources">
<h3><span class="section-number">6.3.2.1. </span>Best practices for reserving resources<a class="headerlink" href="#best-practices-for-reserving-resources" title="Permalink to this heading">#</a></h3>
<p>Note that when you reserve resources for a job using <code class="docutils literal notranslate"><span class="pre">parallel</span></code> that
you generally should not reserve enough cores to run all jobs at once.
This is because tasks are likely to take different amount of times to
run, sometimes significantly so, resulting in a (potentially large)
number of CPUs being idle until the last task has finished.</p>
<p>For this reason we advice that you do not reserve more CPUs than what is
needed to run 1/3 to 1/2 of your jobs at once. This also allows you to
queue that many more simultaneous jobs on Slurm, and will typically
result in a overall greater throughput than simply using the maximum
number of processes with <code class="docutils literal notranslate"><span class="pre">parallel</span></code>.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">plonk</span></code> example from above:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
module<span class="w"> </span>load<span class="w"> </span>plonk/3.14
module<span class="w"> </span>load<span class="w"> </span>parallel/20230822

parallel<span class="w"> </span>-P<span class="w"> </span><span class="si">${</span><span class="nv">SLURM_CPUS_PER_TASK</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>plonk<span class="w"> </span>--input<span class="w"> </span><span class="s2">&quot;./my_data/{}.vcf&quot;</span><span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;./my_results/{}.out&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>:::<span class="w"> </span>CHB<span class="w"> </span>FIN<span class="w"> </span>GBR<span class="w"> </span>JPT<span class="w"> </span>PUR<span class="w"> </span>YRI
</pre></div>
</div>
<p>Let's say that <code class="docutils literal notranslate"><span class="pre">plonk</span></code> is able to use multiple threads and that I
decide to use 4 threads per process. In that case, I could reserve 12
threads for my job and then run 3 instances of <code class="docutils literal notranslate"><span class="pre">plonk</span></code> using
<code class="docutils literal notranslate"><span class="pre">parallel</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --cpus-per-task=12</span>
module<span class="w"> </span>load<span class="w"> </span>plonk/3.14
module<span class="w"> </span>load<span class="w"> </span>parallel/20230822

parallel<span class="w"> </span>-P<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>plonk<span class="w"> </span>--threads<span class="w"> </span><span class="m">4</span><span class="w"> </span>--input<span class="w"> </span><span class="s2">&quot;./my_data/{}.vcf&quot;</span><span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;./my_results/{}.out&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>:::<span class="w"> </span>CHB<span class="w"> </span>FIN<span class="w"> </span>GBR<span class="w"> </span>JPT<span class="w"> </span>PUR<span class="w"> </span>YRI
</pre></div>
</div>
<p>This however has the disadvantage that you have to make sure that
<code class="docutils literal notranslate"><span class="pre">--cpus-per-task</span></code>, <code class="docutils literal notranslate"><span class="pre">-P</span></code>, and <code class="docutils literal notranslate"><span class="pre">--threads</span></code> (or whatever option your
software uses) all line up.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="robust_scripts.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><span class="section-number">6.4. </span>Writing robust bash scripts</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="tmux.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">6.2. </span>Persistent sessions with tmux</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023-2024, CBMR Data Analytics; licensed under CC-BY 4.0
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">6.3. Batching commands outside Slurm</a><ul>
<li><a class="reference internal" href="#running-commands-sequentially-in-bash">6.3.1. Running commands sequentially in bash</a></li>
<li><a class="reference internal" href="#running-commands-in-parallel-in-bash">6.3.2. Running commands in parallel in bash</a><ul>
<li><a class="reference internal" href="#best-practices-for-reserving-resources">6.3.2.1. Best practices for reserving resources</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../_static/js/custom.js?v=7a324050"></script>
    <script src="../_static/js/libgif.js?v=7adcb026"></script>
    <script src="../_static/js/playback.js?v=c0a59f95"></script>
    </body>
</html>