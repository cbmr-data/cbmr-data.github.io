<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="search" title="Search" href="../search.html" /><link rel="next" title="Writing robust bash scripts" href="robust_scripts.html" /><link rel="prev" title="Persistent sessions with tmux" href="tmux.html" />

    <!-- Generated with Sphinx 7.4.7 and Furo 2024.04.27 -->
        <title>Batching commands in bash - Esrum Cluster documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=437aa6ec" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/playback.css?v=2c0b8537" />
    <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=14071cef" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Esrum Cluster  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Esrum Cluster  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Front page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">Contact us</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview of cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guidelines.html">Guidelines and policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using the cluster</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage/access/access.html">Applying for access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/access/connecting.html">Connecting to the cluster</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../usage/filesystem.html">Data storage on Esrum</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Data storage on Esrum</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../usage/projects.html">Requesting projects and datasets</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../usage/slurm/index.html">Running jobs using Slurm</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Running jobs using Slurm</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../usage/slurm/basics.html">Basic Slurm jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/slurm/advanced.html">Advanced Slurm jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/slurm/monitoring.html">Monitoring slurm jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/slurm/gpu.html">GPU / high-memory jobs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usage/modules.html">Software on Esrum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/transfers.html">Transferring data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../resources/cohorts.html">Human cohorts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/common.html">Common datasets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../services/rstudio.html">RStudio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/networkdrives.html">Network drives (H:, N:, S:)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/jupyter.html">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/containers.html">Containerized software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/shiny.html">Shiny servers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tips and tricks</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ports.html">Port forwarding</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Creating environment modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="tmux.html">Persistent sessions with tmux</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Batching commands in bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="robust_scripts.html">Writing robust bash scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="snakemake.html">Using Snakemake on Esrum</a></li>
<li class="toctree-l1"><a class="reference internal" href="r.html">Using R on Esrum</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Outreach</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../communications/messages.html">Welcome email</a></li>
<li class="toctree-l1"><a class="reference internal" href="../communications/presentations.html">Presentations</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/cbmr-data/cbmr-data.github.io/edit/main/esrum/source/tips/batching_commands.rst" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="batching-commands-in-bash">
<span id="p-tips-batching"></span><h1>Batching commands in bash<a class="headerlink" href="#batching-commands-in-bash" title="Link to this heading">¶</a></h1>
<p>This section describes way to batch commands without using Slurm. This
is intended to be used both with singular jobs and in conjunction with
Slurm job arrays (see the <a class="reference internal" href="../usage/slurm/advanced.html#s-job-arrays"><span class="std std-ref">Running multiple tasks using arrays</span></a> section), for example when
you need to run many small jobs.</p>
<p>Running tasks as described on this page has a lower overhead than jobs
scheduled tasks via Slurm, and is therefore well suited for running
many, small tasks. However, for larger jobs you should still prefer job
arrays if possible.</p>
<p>This section covers basic loops in bash and the <cite>parallel</cite> command.
Other options include <a class="reference external" href="https://man7.org/linux/man-pages/man1/xargs.1.html">xargs</a>, <a class="reference external" href="https://www.gnu.org/software/make/">make</a>, <a class="reference external" href="https://snakemake.readthedocs.io/">snakemake</a>, and much, much more.</p>
<section id="running-commands-sequentially-in-bash">
<h2>Running commands sequentially in bash<a class="headerlink" href="#running-commands-sequentially-in-bash" title="Link to this heading">¶</a></h2>
<p>If you need to run a number of (very) short running commands, then it is
likely more efficient to do so with a simple loop in your <code class="docutils literal notranslate"><span class="pre">sbatch</span></code>
script. For example, this script runs the <code class="docutils literal notranslate"><span class="pre">plonk</span></code> command on a number
of population VCF files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="ch">#!/bin/bash</span>
<span class="linenos">2</span>module<span class="w"> </span>load<span class="w"> </span>plonk/3.14
<span class="linenos">3</span>
<span class="linenos">4</span><span class="k">for</span><span class="w"> </span>pop<span class="w"> </span><span class="k">in</span><span class="w"> </span>CHB<span class="w"> </span>FIN<span class="w"> </span>GBR<span class="w"> </span>JPT<span class="w"> </span>PUR<span class="w"> </span>YRI<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="linenos">5</span><span class="w">  </span>plonk<span class="w"> </span>--input<span class="w"> </span><span class="s2">&quot;./my_data/</span><span class="si">${</span><span class="nv">pop</span><span class="si">}</span><span class="s2">.vcf&quot;</span><span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;./my_results/</span><span class="si">${</span><span class="nv">pop</span><span class="si">}</span><span class="s2">.out&quot;</span>
<span class="linenos">6</span><span class="k">done</span>
</pre></div>
</div>
<p>The following command indexes a number of (small) BAM files in the
current directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="ch">#!/bin/bash</span>
<span class="linenos">2</span>module<span class="w"> </span>load<span class="w"> </span>samtools/1.17
<span class="linenos">3</span>
<span class="linenos">4</span><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>./*.bam<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="linenos">5</span><span class="w">  </span>samtools<span class="w"> </span>index<span class="w"> </span><span class="si">${</span><span class="nv">filename</span><span class="si">}</span>
<span class="linenos">6</span><span class="k">done</span>
</pre></div>
</div>
<p>However, it is important to remember that the total runtime will be the
<em>sum</em> of run-times for each task, since they are run one after the
other. It is therefore not recommended to use loops like this for
commands that take more than a few of minutes to complete!</p>
</section>
<section id="running-commands-in-parallel-in-bash">
<h2>Running commands in parallel in bash<a class="headerlink" href="#running-commands-in-parallel-in-bash" title="Link to this heading">¶</a></h2>
<p>The GNU <a class="reference external" href="https://www.gnu.org/software/parallel/">parallel</a> commands offers a range of options for running
commands in parallel.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="ch">#!/bin/bash</span>
<span class="linenos">2</span>module<span class="w"> </span>load<span class="w"> </span>plonk/3.14
<span class="linenos">3</span>module<span class="w"> </span>load<span class="w"> </span>parallel/20230822
<span class="linenos">4</span>
<span class="linenos">5</span>parallel<span class="w"> </span>-P<span class="w"> </span><span class="si">${</span><span class="nv">SLURM_CPUS_PER_TASK</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">6</span><span class="w">  </span>plonk<span class="w"> </span>--input<span class="w"> </span><span class="s2">&quot;./my_data/{}.vcf&quot;</span><span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;./my_results/{}.out&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">7</span><span class="w">  </span>:::<span class="w"> </span>CHB<span class="w"> </span>FIN<span class="w"> </span>GBR<span class="w"> </span>JPT<span class="w"> </span>PUR<span class="w"> </span>YRI
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">parallel</span></code> command will then execute <code class="docutils literal notranslate"><span class="pre">plonk</span></code> once for each of
the values we specified after the <code class="docutils literal notranslate"><span class="pre">:::</span></code> and replace the text <code class="docutils literal notranslate"><span class="pre">{}</span></code>
with the current value.</p>
<p>The second <code class="docutils literal notranslate"><span class="pre">xargs</span></code> example above can be run in parallel as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="ch">#!/bin/bash</span>
<span class="linenos">2</span>module<span class="w"> </span>load<span class="w"> </span>samtools/1.17
<span class="linenos">3</span>module<span class="w"> </span>load<span class="w"> </span>parallel/20230822
<span class="linenos">4</span>
<span class="linenos">5</span>parallel<span class="w"> </span>-P<span class="w"> </span><span class="si">${</span><span class="nv">SLURM_CPUS_PER_TASK</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">6</span><span class="w">  </span>samtools<span class="w"> </span>index<span class="w"> </span><span class="s2">&quot;{}&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">7</span><span class="w">  </span>:::<span class="w"> </span>./*.bam
</pre></div>
</div>
<p>If no <code class="docutils literal notranslate"><span class="pre">{}</span></code> is specified the value will be appended to the command.
Additionally, <code class="docutils literal notranslate"><span class="pre">parallel</span></code> can read values from STDIN, meaning that the
above could also be written as</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="ch">#!/bin/bash</span>
<span class="linenos">2</span>module<span class="w"> </span>load<span class="w"> </span>samtools/1.17
<span class="linenos">3</span>module<span class="w"> </span>load<span class="w"> </span>parallel/20230822
<span class="linenos">4</span>
<span class="linenos">5</span>ls<span class="w"> </span>./*.bam<span class="w"> </span><span class="p">|</span><span class="w"> </span>parallel<span class="w"> </span>-P<span class="w"> </span><span class="si">${</span><span class="nv">SLURM_CPUS_PER_TASK</span><span class="si">}</span><span class="w"> </span>samtools<span class="w"> </span>index
</pre></div>
</div>
<p>Each line on STDIN is treated as one value.</p>
<section id="best-practices-for-reserving-resources">
<h3>Best practices for reserving resources<a class="headerlink" href="#best-practices-for-reserving-resources" title="Link to this heading">¶</a></h3>
<p>Note that when you reserve resources for a job using <code class="docutils literal notranslate"><span class="pre">parallel</span></code> that
you generally should not reserve enough cores to run all jobs at once.
This is because tasks are likely to take different amount of times to
run, sometimes significantly so, resulting in a (potentially large)
number of CPUs being idle until the last task has finished.</p>
<p>For this reason we advise that you do not reserve more CPUs than what is
needed to run 1/3 to 1/2 of your jobs at once. This also allows you to
queue that many more simultaneous jobs on Slurm, and will typically
result in an overall greater throughput than simply using the maximum
number of processes with <code class="docutils literal notranslate"><span class="pre">parallel</span></code>.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">plonk</span></code> example from above:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="ch">#!/bin/bash</span>
<span class="linenos">2</span>module<span class="w"> </span>load<span class="w"> </span>plonk/3.14
<span class="linenos">3</span>module<span class="w"> </span>load<span class="w"> </span>parallel/20230822
<span class="linenos">4</span>
<span class="linenos">5</span>parallel<span class="w"> </span>-P<span class="w"> </span><span class="si">${</span><span class="nv">SLURM_CPUS_PER_TASK</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">6</span><span class="w">  </span>plonk<span class="w"> </span>--input<span class="w"> </span><span class="s2">&quot;./my_data/{}.vcf&quot;</span><span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;./my_results/{}.out&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">7</span><span class="w">  </span>:::<span class="w"> </span>CHB<span class="w"> </span>FIN<span class="w"> </span>GBR<span class="w"> </span>JPT<span class="w"> </span>PUR<span class="w"> </span>YRI
</pre></div>
</div>
<p>Let's say that <code class="docutils literal notranslate"><span class="pre">plonk</span></code> is able to use multiple threads and that I
decide to use 4 threads per process. In that case, I could reserve 12
threads for my job and then run 3 instances of <code class="docutils literal notranslate"><span class="pre">plonk</span></code> using
<code class="docutils literal notranslate"><span class="pre">parallel</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="ch">#!/bin/bash</span>
<span class="linenos">2</span><span class="c1">#SBATCH --cpus-per-task=12</span>
<span class="linenos">3</span>module<span class="w"> </span>load<span class="w"> </span>plonk/3.14
<span class="linenos">4</span>module<span class="w"> </span>load<span class="w"> </span>parallel/20230822
<span class="linenos">5</span>
<span class="linenos">6</span>parallel<span class="w"> </span>-P<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">7</span><span class="w">  </span>plonk<span class="w"> </span>--threads<span class="w"> </span><span class="m">4</span><span class="w"> </span>--input<span class="w"> </span><span class="s2">&quot;./my_data/{}.vcf&quot;</span><span class="w"> </span>--output<span class="w"> </span><span class="s2">&quot;./my_results/{}.out&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="linenos">8</span><span class="w">  </span>:::<span class="w"> </span>CHB<span class="w"> </span>FIN<span class="w"> </span>GBR<span class="w"> </span>JPT<span class="w"> </span>PUR<span class="w"> </span>YRI
</pre></div>
</div>
<p>This however has the disadvantage that you have to make sure that
<code class="docutils literal notranslate"><span class="pre">--cpus-per-task</span></code>, <code class="docutils literal notranslate"><span class="pre">-P</span></code>, and <code class="docutils literal notranslate"><span class="pre">--threads</span></code> (or whatever option your
software uses) all line up.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="robust_scripts.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Writing robust bash scripts</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="tmux.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Persistent sessions with tmux</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023-2024, CBMR Data Analytics; licensed under CC-BY 4.0
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Batching commands in bash</a><ul>
<li><a class="reference internal" href="#running-commands-sequentially-in-bash">Running commands sequentially in bash</a></li>
<li><a class="reference internal" href="#running-commands-in-parallel-in-bash">Running commands in parallel in bash</a><ul>
<li><a class="reference internal" href="#best-practices-for-reserving-resources">Best practices for reserving resources</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=4e2eecee"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=a7c4b63f"></script>
    <script src="../_static/js/custom.js?v=d3d7fd27"></script>
    <script src="../_static/js/libgif.js?v=7adcb026"></script>
    <script src="../_static/js/playback.js?v=d7002ce9"></script>
    </body>
</html>